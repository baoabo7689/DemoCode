const Polyglot = require("node-polyglot");
const { loadDefaultResource } = require("./resources");
const defaultLocale = "en-US";
const supportedLanguages = ["en-US", "id-ID", "th-TH", "zh-CN", "zh-TW"];

const initPolyglot = (locale = defaultLocale, resources = null) => {
  const isLanguageSupported = supportedLanguages.filter((lang) => lang == locale).length != 0;
  locale = isLanguageSupported ? locale : defaultLocale;

  const combinedResources = Object.assign({}, loadDefaultResource(locale), resources ?? {});
  const polyglotInstance = new Polyglot({ phrases: combinedResources, locale });

  polyglotInstance.reload = initPolyglot;
  polyglotInstance.keys = Object.assign({}, ...Object.keys(polyglotInstance.phrases).map((key) => ({ [key]: key })));

  return polyglotInstance;
};

module.exports = {
  getInstance: initPolyglot,
};
